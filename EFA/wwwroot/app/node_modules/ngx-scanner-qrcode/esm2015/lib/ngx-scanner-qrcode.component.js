/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, EventEmitter, ViewChild, ViewEncapsulation } from '@angular/core';
import { BehaviorSubject, AsyncSubject } from 'rxjs';
import { AS_COMPLETE, BLOB_TO_FILE, CANVAS_TO_BLOB, DRAW_RESULT_APPEND_CHILD, FILES_TO_SCAN, HAS_OWN_PROPERTY, OVERRIDES, PLAY_AUDIO, VIBRATE } from './ngx-scanner-qrcode.helper';
import { CONFIG_DEFAULT, MEDIA_STREAM_DEFAULT } from './ngx-scanner-qrcode.default';
export class NgxScannerQrcodeComponent {
    constructor() {
        /**
         * EventEmitter
         */
        this.event = new EventEmitter();
        /**
         * Input
         */
        this.src = CONFIG_DEFAULT.src;
        this.fps = CONFIG_DEFAULT.fps;
        this.vibrate = CONFIG_DEFAULT.vibrate;
        this.decode = CONFIG_DEFAULT.decode;
        this.isBeep = CONFIG_DEFAULT.isBeep;
        this.deviceActive = CONFIG_DEFAULT.deviceActive;
        this.config = CONFIG_DEFAULT;
        this.constraints = CONFIG_DEFAULT.constraints;
        /**
         * Export
         */
        this.isStart = false;
        this.isLoading = false;
        this.isTorch = false;
        this.data = new BehaviorSubject([]);
        this.devices = new BehaviorSubject([]);
        this.dataForResize = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.overrideConfig();
        if (this.src) {
            this.loadImage(this.src);
        }
        this.resize();
    }
    /**
     * start
     * @return {?} AsyncSubject
     */
    start() {
        /** @type {?} */
        const as = new AsyncSubject();
        if (this.isStart) {
            // Reject
            AS_COMPLETE(as, false);
        }
        else {
            // mediaDevices
            this.loadAllDevices(as);
        }
        return as;
    }
    /**
     * playDevice
     * @param {?} deviceId
     * @param {?=} as
     * @return {?} AsyncSubject
     */
    playDevice(deviceId, as = new AsyncSubject()) {
        /** @type {?} */
        const existDeviceId = this.isStart ? this.getConstraints().deviceId != deviceId : true;
        switch (true) {
            case deviceId == 'null' || deviceId == null:
                this.stop();
                AS_COMPLETE(as, false);
                break;
            case deviceId && existDeviceId:
                stop();
                this.stop();
                clearInterval(this.rAF_ID);
                // Loading on
                this.status(false, true);
                /** @type {?} */
                const constraints = {
                    audio: false,
                    video: (typeof (this.constraints && this.constraints.video) === 'boolean') ? { deviceId: deviceId } : Object.assign({ deviceId: deviceId }, this.constraints && this.constraints.video)
                };
                this.deviceActive = this.devices.value.findIndex((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => f.deviceId == deviceId));
                // MediaStream
                navigator.mediaDevices.getUserMedia(constraints).then((/**
                 * @param {?} stream
                 * @return {?}
                 */
                (stream) => {
                    this.video.nativeElement.srcObject = stream;
                    this.video.nativeElement.onloadedmetadata = (/**
                     * @return {?}
                     */
                    () => {
                        this.video.nativeElement.play();
                        this.requestAnimationFrame();
                        this.status(true, false);
                        AS_COMPLETE(as, true);
                    });
                })).catch((/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    this.status(false, false);
                    this.eventEmit(false);
                    AS_COMPLETE(as, false, error);
                }));
                break;
            default:
                AS_COMPLETE(as, false);
                break;
        }
        return as;
    }
    /**
     * stop
     * @return {?} AsyncSubject
     */
    stop() {
        this.eventEmit(null);
        this.status(false, false);
        /** @type {?} */
        const as = new AsyncSubject();
        try {
            this.removeCanvas();
            clearInterval(this.rAF_ID);
            ((/** @type {?} */ (this.video.nativeElement.srcObject))).getTracks().forEach((/**
             * @param {?} track
             * @return {?}
             */
            (track) => {
                track.stop();
                AS_COMPLETE(as, true);
            }));
        }
        catch (error) {
            AS_COMPLETE(as, false, (/** @type {?} */ (error)));
        }
        return as;
    }
    /**
     * play
     * @return {?} AsyncSubject
     */
    play() {
        /** @type {?} */
        const as = new AsyncSubject();
        if (this.isPause) {
            this.video.nativeElement.play();
            this.requestAnimationFrame();
            AS_COMPLETE(as, true);
        }
        else {
            AS_COMPLETE(as, false);
        }
        return as;
    }
    /**
     * pause
     * @return {?} AsyncSubject
     */
    pause() {
        /** @type {?} */
        const as = new AsyncSubject();
        if (this.isStart) {
            clearInterval(this.rAF_ID);
            this.video.nativeElement.pause();
            AS_COMPLETE(as, true);
        }
        else {
            AS_COMPLETE(as, false);
        }
        return as;
    }
    /**
     * loadImage
     * @param {?} src
     * @return {?} AsyncSubject
     */
    loadImage(src) {
        /** @type {?} */
        const as = new AsyncSubject();
        // Loading on
        this.status(false, true);
        // Set the src of this Image object.
        /** @type {?} */
        const image = new Image();
        // Setting cross origin value to anonymous
        image.setAttribute('crossOrigin', 'anonymous');
        // When our image has loaded.
        image.onload = (/**
         * @return {?}
         */
        () => {
            this.drawImage(image, (/**
             * @param {?} flag
             * @return {?}
             */
            (flag) => {
                this.status(false, false);
                AS_COMPLETE(as, flag);
            }));
        });
        // Set src
        image.src = src;
        return as;
    }
    /**
     * torcher
     * @return {?} AsyncSubject
     */
    torcher() {
        /** @type {?} */
        const as = this.applyConstraints({ torch: this.isTorch });
        as.subscribe((/**
         * @return {?}
         */
        () => false), (/**
         * @return {?}
         */
        () => this.isTorch = !this.isTorch));
        return as;
    }
    /**
     * applyConstraints
     * @param {?} constraints
     * @return {?} AsyncSubject
     */
    applyConstraints(constraints) {
        /** @type {?} */
        const as = new AsyncSubject();
        /** @type {?} */
        const stream = (/** @type {?} */ (this.video.nativeElement.srcObject));
        /** @type {?} */
        const videoTrack = (/** @type {?} */ (stream.getVideoTracks()[0]));
        /** @type {?} */
        const imageCapture = new ((/** @type {?} */ (window))).ImageCapture(videoTrack);
        imageCapture.getPhotoCapabilities().then((/**
         * @return {?}
         */
        () => tslib_1.__awaiter(this, void 0, void 0, function* () {
            yield videoTrack.applyConstraints((/** @type {?} */ ({ advanced: [constraints] })));
            AS_COMPLETE(as, true);
        }))).catch((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            switch (error && error.name) {
                case 'NotFoundError':
                case 'DevicesNotFoundError':
                    AS_COMPLETE(as, false, (/** @type {?} */ ('Required track is missing')));
                    break;
                case 'NotReadableError':
                case 'TrackStartError':
                    AS_COMPLETE(as, false, (/** @type {?} */ ('Webcam or mic are already in use')));
                    break;
                case 'OverconstrainedError':
                case 'ConstraintNotSatisfiedError':
                    AS_COMPLETE(as, false, (/** @type {?} */ ('Constraints can not be satisfied by avb. devices')));
                    break;
                case 'NotAllowedError':
                case 'PermissionDeniedError':
                    AS_COMPLETE(as, false, (/** @type {?} */ ('Permission denied in browser')));
                    break;
                case 'TypeError':
                    AS_COMPLETE(as, false, (/** @type {?} */ ('Empty constraints object')));
                    break;
                default:
                    AS_COMPLETE(as, false, (/** @type {?} */ (error)));
                    break;
            }
        }));
        return as;
    }
    ;
    /**
     * getConstraints
     * @return {?}
     */
    getConstraints() {
        /** @type {?} */
        const stream = (/** @type {?} */ (this.video.nativeElement.srcObject));
        /** @type {?} */
        const videoTrack = stream && (/** @type {?} */ (stream.getVideoTracks()[0]));
        return videoTrack && (/** @type {?} */ (videoTrack.getConstraints()));
    }
    /**
     * download
     * @param {?=} fileName
     * @return {?} AsyncSubject
     */
    download(fileName = `ngx-scanner-qrcode-${Date.now()}.png`) {
        /** @type {?} */
        const as = new AsyncSubject();
        /** @type {?} */
        const run = (/**
         * @return {?}
         */
        () => tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const blob = yield CANVAS_TO_BLOB(this.canvas.nativeElement);
            /** @type {?} */
            const file = BLOB_TO_FILE(blob, fileName);
            FILES_TO_SCAN([file], this.config, as).subscribe((/**
             * @param {?} res
             * @return {?}
             */
            (res) => {
                res.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                (item) => {
                    /** @type {?} */
                    const link = document.createElement('a');
                    link.href = item.url;
                    link.download = item.name;
                    link.click();
                    link.remove();
                }));
            }));
        }));
        run();
        return as;
    }
    /**
     * window: resize
     * Draw again!
     * @private
     * @return {?}
     */
    resize() {
        window.addEventListener("resize", (/**
         * @return {?}
         */
        () => {
            if (this.dataForResize && this.dataForResize.length) {
                DRAW_RESULT_APPEND_CHILD((/** @type {?} */ (this.dataForResize)), this.canvas.nativeElement, this.resultsPanel.nativeElement);
            }
        }));
    }
    /**
     * Override config
     * @private
     * @return {?} void
     */
    overrideConfig() {
        if (HAS_OWN_PROPERTY(this.config, 'src'))
            this.src = this.config.src;
        if (HAS_OWN_PROPERTY(this.config, 'fps'))
            this.fps = this.config.fps;
        if (HAS_OWN_PROPERTY(this.config, 'vibrate'))
            this.vibrate = this.config.vibrate;
        if (HAS_OWN_PROPERTY(this.config, 'decode'))
            this.decode = this.config.decode;
        if (HAS_OWN_PROPERTY(this.config, 'isBeep'))
            this.isBeep = this.config.isBeep;
        if (HAS_OWN_PROPERTY(this.config, 'deviceActive'))
            this.deviceActive = this.config.deviceActive;
        if (HAS_OWN_PROPERTY(this.config, 'constraints'))
            this.constraints = OVERRIDES('constraints', this.config, MEDIA_STREAM_DEFAULT);
    }
    /**
     * loadAllDevices
     * @private
     * @param {?} as
     * @return {?}
     */
    loadAllDevices(as) {
        navigator.mediaDevices.enumerateDevices().then((/**
         * @param {?} devices
         * @return {?}
         */
        devices => {
            /** @type {?} */
            let cameraDevices = [];
            devices.forEach((/**
             * @param {?} f
             * @return {?}
             */
            f => f.kind == 'videoinput' && cameraDevices.push(f)));
            this.devices.next(cameraDevices);
            if (cameraDevices.length > 0) {
                /** @type {?} */
                const index = Math.max(0, (cameraDevices.length > this.deviceActive ? this.deviceActive : 0));
                this.playDevice(cameraDevices[index].deviceId, as);
            }
            else {
                AS_COMPLETE(as, false, (/** @type {?} */ ('No camera detected.')));
            }
        }));
    }
    /**
     * drawImage
     * @private
     * @param {?} element
     * @param {?=} callback
     * @return {?}
     */
    drawImage(element, callback = (/**
     * @return {?}
     */
    () => { })) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            // Get the canvas element by using the getElementById method.
            /** @type {?} */
            const canvas = this.canvas.nativeElement;
            // Get a 2D drawing context for the canvas.
            /** @type {?} */
            const ctx = (/** @type {?} */ (canvas.getContext('2d', { willReadFrequently: true })));
            // HTMLImageElement size
            if (element instanceof HTMLImageElement) {
                canvas.width = element.naturalWidth;
                canvas.height = element.naturalHeight;
                element.style.visibility = '';
                this.video.nativeElement.style.visibility = 'hidden';
                this.video.nativeElement.style.height = canvas.offsetHeight + 'px';
            }
            // HTMLVideoElement size
            if (element instanceof HTMLVideoElement) {
                canvas.width = element.videoWidth;
                canvas.height = element.videoHeight;
                element.style.visibility = '';
                this.canvas.nativeElement.style.visibility = 'hidden';
            }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Draw image
            ctx.drawImage(element, 0, 0, canvas.width, canvas.height);
            // Data image
            /** @type {?} */
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            // Draw frame
            /** @type {?} */
            const code = yield zbarWasm.scanImageData(imageData);
            if (code && code.length) {
                // Decode
                code.forEach((/**
                 * @param {?} s
                 * @return {?}
                 */
                (s) => s.value = s.decode(this.decode && this.decode.toLocaleLowerCase())));
                // Overlay
                DRAW_RESULT_APPEND_CHILD(code, Object.freeze(this.canvas.nativeElement), this.resultsPanel.nativeElement);
                // To blob and emit data
                /** @type {?} */
                const EMIT_DATA = (/**
                 * @return {?}
                 */
                () => {
                    this.eventEmit(code);
                    this.dataForResize = code;
                });
                // HTMLImageElement
                if (element instanceof HTMLImageElement) {
                    callback(true);
                    EMIT_DATA();
                    VIBRATE(this.vibrate);
                    PLAY_AUDIO(this.isBeep);
                }
                // HTMLVideoElement
                if (element instanceof HTMLVideoElement) {
                    EMIT_DATA();
                    VIBRATE(this.vibrate);
                    PLAY_AUDIO(this.isBeep);
                }
            }
            else {
                callback(false);
                this.removeCanvas();
                this.dataForResize = code;
            }
        });
    }
    /**
     * removeCanvas
     * @private
     * @return {?}
     */
    removeCanvas() {
        Object.assign([], this.resultsPanel.nativeElement.childNodes).forEach((/**
         * @param {?} el
         * @return {?}
         */
        el => this.resultsPanel.nativeElement.removeChild(el)));
    }
    /**
     * status
     * @private
     * @param {?} isStart
     * @param {?} isLoading
     * @return {?}
     */
    status(isStart, isLoading) {
        this.isStart = isStart;
        this.isLoading = isLoading;
    }
    /**
     * eventEmit
     * @private
     * @param {?=} response
     * @return {?}
     */
    eventEmit(response = false) {
        (response !== false) && this.data.next(response || { data: null });
        (response !== false) && this.event.emit(response || { data: null });
    }
    /**
     * Single-thread
     * Loop Recording on Camera
     * Must be destroy request
     * Not using: requestAnimationFrame
     * @private
     * @return {?}
     */
    requestAnimationFrame() {
        this.rAF_ID = setInterval((/**
         * @return {?}
         */
        () => {
            if (this.video.nativeElement.readyState === this.video.nativeElement.HAVE_ENOUGH_DATA) {
                this.drawImage(this.video.nativeElement);
            }
        }), this.fps);
    }
    /**
     * Status of camera
     * @return {?} boolean
     */
    get isPause() {
        return this.isStart && this.video.nativeElement.paused;
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.pause();
    }
}
NgxScannerQrcodeComponent.decorators = [
    { type: Component, args: [{
                selector: 'ngx-scanner-qrcode',
                template: `<div #resultsPanel class="origin-overlay"></div><canvas #canvas class="origin-canvas"></canvas><video #video playsinline class="origin-video"></video>`,
                host: { 'class': 'ngx-scanner-qrcode' },
                exportAs: 'scanner',
                inputs: ['src', 'fps', 'vibrate', 'decode', 'isBeep', 'deviceActive', 'config', 'constraints'],
                outputs: ['event'],
                queries: {
                    video: new ViewChild('video'),
                    canvas: new ViewChild('canvas'),
                    resultsPanel: new ViewChild('resultsPanel')
                },
                encapsulation: ViewEncapsulation.None,
                styles: [".ngx-scanner-qrcode{display:block;position:relative}.origin-overlay{width:100%;position:absolute}.origin-overlay span{z-index:2;color:red;text-align:left;position:absolute}.origin-overlay .qrcode-polygon{z-index:1;position:absolute}.origin-canvas{width:100%;position:absolute}.origin-video{width:100%;background-color:#262626}.qrcode-tooltip{z-index:3;position:absolute}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute}.qrcode-tooltip-temp{bottom:0;left:50%;padding:5px;color:#fff;text-align:left;display:none;max-width:450px;border-radius:5px;width:-moz-max-content;width:max-content;word-wrap:break-word;transform:translate(-50%);transform-style:preserve-3d;background-color:#000000d0;box-shadow:1px 1px 20px #000000e0}"]
            }] }
];
if (false) {
    /**
     * Element
     * playsinline required to tell iOS safari we don't want fullscreen
     * @type {?}
     */
    NgxScannerQrcodeComponent.prototype.video;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.canvas;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.resultsPanel;
    /**
     * EventEmitter
     * @type {?}
     */
    NgxScannerQrcodeComponent.prototype.event;
    /**
     * Input
     * @type {?}
     */
    NgxScannerQrcodeComponent.prototype.src;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.fps;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.vibrate;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.decode;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.isBeep;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.deviceActive;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.config;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.constraints;
    /**
     * Export
     * @type {?}
     */
    NgxScannerQrcodeComponent.prototype.isStart;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.isLoading;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.isTorch;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.data;
    /** @type {?} */
    NgxScannerQrcodeComponent.prototype.devices;
    /**
     * Private
     * @type {?}
     * @private
     */
    NgxScannerQrcodeComponent.prototype.rAF_ID;
    /**
     * @type {?}
     * @private
     */
    NgxScannerQrcodeComponent.prototype.dataForResize;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNjYW5uZXItcXJjb2RlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1zY2FubmVyLXFyY29kZS8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtc2Nhbm5lci1xcmNvZGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBYyxZQUFZLEVBQXFCLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNySCxPQUFPLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyRCxPQUFPLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsd0JBQXdCLEVBQUUsYUFBYSxFQUFFLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFbkwsT0FBTyxFQUFFLGNBQWMsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBa0JwRixNQUFNO0lBZk47UUF5QkU7O1dBRUc7UUFDSSxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQXlCLENBQUM7UUFFekQ7O1dBRUc7UUFDSSxRQUFHLEdBQXVCLGNBQWMsQ0FBQyxHQUFHLENBQUM7UUFDN0MsUUFBRyxHQUF1QixjQUFjLENBQUMsR0FBRyxDQUFDO1FBQzdDLFlBQU8sR0FBdUIsY0FBYyxDQUFDLE9BQU8sQ0FBQztRQUNyRCxXQUFNLEdBQXVCLGNBQWMsQ0FBQyxNQUFNLENBQUM7UUFDbkQsV0FBTSxHQUF3QixjQUFjLENBQUMsTUFBTSxDQUFDO1FBQ3BELGlCQUFZLEdBQXVCLGNBQWMsQ0FBQyxZQUFZLENBQUM7UUFDL0QsV0FBTSxHQUF3QixjQUFjLENBQUM7UUFDN0MsZ0JBQVcsR0FBNkMsY0FBYyxDQUFDLFdBQVcsQ0FBQztRQUUxRjs7V0FFRztRQUNJLFlBQU8sR0FBWSxLQUFLLENBQUM7UUFDekIsY0FBUyxHQUFZLEtBQUss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RDs7Ozs7SUFLakQsMENBQXlEOzs7OztJQUt6RCx3Q0FBb0Q7O0lBQ3BELHdDQUFvRDs7SUFDcEQsNENBQTREOztJQUM1RCwyQ0FBMEQ7O0lBQzFELDJDQUEyRDs7SUFDM0QsaURBQXNFOztJQUN0RSwyQ0FBb0Q7O0lBQ3BELGdEQUEwRjs7Ozs7SUFLMUYsNENBQWdDOztJQUNoQyw4Q0FBa0M7O0lBQ2xDLDRDQUFnQzs7SUFDaEMseUNBQTZEOztJQUM3RCw0Q0FBZ0U7Ozs7OztJQUtoRSwyQ0FBb0I7Ozs7O0lBQ3BCLGtEQUFrRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBPbkRlc3Ryb3ksIE9uSW5pdCwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIEFzeW5jU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBBU19DT01QTEVURSwgQkxPQl9UT19GSUxFLCBDQU5WQVNfVE9fQkxPQiwgRFJBV19SRVNVTFRfQVBQRU5EX0NISUxELCBGSUxFU19UT19TQ0FOLCBIQVNfT1dOX1BST1BFUlRZLCBPVkVSUklERVMsIFBMQVlfQVVESU8sIFZJQlJBVEUgfSBmcm9tICcuL25neC1zY2FubmVyLXFyY29kZS5oZWxwZXInO1xyXG5pbXBvcnQgeyBTY2FubmVyUVJDb2RlQ29uZmlnLCBTY2FubmVyUVJDb2RlRGV2aWNlLCBTY2FubmVyUVJDb2RlUmVzdWx0LCBTY2FubmVyUVJDb2RlU2VsZWN0ZWRGaWxlcyB9IGZyb20gJy4vbmd4LXNjYW5uZXItcXJjb2RlLm9wdGlvbnMnO1xyXG5pbXBvcnQgeyBDT05GSUdfREVGQVVMVCwgTUVESUFfU1RSRUFNX0RFRkFVTFQgfSBmcm9tICcuL25neC1zY2FubmVyLXFyY29kZS5kZWZhdWx0JztcclxuZGVjbGFyZSBjb25zdCB6YmFyV2FzbTogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICduZ3gtc2Nhbm5lci1xcmNvZGUnLFxyXG4gIHRlbXBsYXRlOiBgPGRpdiAjcmVzdWx0c1BhbmVsIGNsYXNzPVwib3JpZ2luLW92ZXJsYXlcIj48L2Rpdj48Y2FudmFzICNjYW52YXMgY2xhc3M9XCJvcmlnaW4tY2FudmFzXCI+PC9jYW52YXM+PHZpZGVvICN2aWRlbyBwbGF5c2lubGluZSBjbGFzcz1cIm9yaWdpbi12aWRlb1wiPjwvdmlkZW8+YCxcclxuICBzdHlsZVVybHM6IFsnLi9uZ3gtc2Nhbm5lci1xcmNvZGUuY29tcG9uZW50LnNjc3MnXSxcclxuICBob3N0OiB7ICdjbGFzcyc6ICduZ3gtc2Nhbm5lci1xcmNvZGUnIH0sXHJcbiAgZXhwb3J0QXM6ICdzY2FubmVyJyxcclxuICBpbnB1dHM6IFsnc3JjJywgJ2ZwcycsICd2aWJyYXRlJywgJ2RlY29kZScsICdpc0JlZXAnLCAnZGV2aWNlQWN0aXZlJywgJ2NvbmZpZycsICdjb25zdHJhaW50cyddLFxyXG4gIG91dHB1dHM6IFsnZXZlbnQnXSxcclxuICBxdWVyaWVzOiB7XHJcbiAgICB2aWRlbzogbmV3IFZpZXdDaGlsZCgndmlkZW8nKSxcclxuICAgIGNhbnZhczogbmV3IFZpZXdDaGlsZCgnY2FudmFzJyksXHJcbiAgICByZXN1bHRzUGFuZWw6IG5ldyBWaWV3Q2hpbGQoJ3Jlc3VsdHNQYW5lbCcpXHJcbiAgfSxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZ3hTY2FubmVyUXJjb2RlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICAvKipcclxuICAgKiBFbGVtZW50XHJcbiAgICogcGxheXNpbmxpbmUgcmVxdWlyZWQgdG8gdGVsbCBpT1Mgc2FmYXJpIHdlIGRvbid0IHdhbnQgZnVsbHNjcmVlblxyXG4gICAqL1xyXG4gIHB1YmxpYyB2aWRlbyE6IEVsZW1lbnRSZWY8SFRNTFZpZGVvRWxlbWVudD47XHJcbiAgcHVibGljIGNhbnZhcyE6IEVsZW1lbnRSZWY8SFRNTENhbnZhc0VsZW1lbnQ+O1xyXG4gIHB1YmxpYyByZXN1bHRzUGFuZWwhOiBFbGVtZW50UmVmPEhUTUxEaXZFbGVtZW50PjtcclxuXHJcbiAgLyoqXHJcbiAgICogRXZlbnRFbWl0dGVyXHJcbiAgICovXHJcbiAgcHVibGljIGV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxTY2FubmVyUVJDb2RlUmVzdWx0W10+KCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIElucHV0XHJcbiAgICovXHJcbiAgcHVibGljIHNyYzogc3RyaW5nIHwgdW5kZWZpbmVkID0gQ09ORklHX0RFRkFVTFQuc3JjO1xyXG4gIHB1YmxpYyBmcHM6IG51bWJlciB8IHVuZGVmaW5lZCA9IENPTkZJR19ERUZBVUxULmZwcztcclxuICBwdWJsaWMgdmlicmF0ZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gQ09ORklHX0RFRkFVTFQudmlicmF0ZTtcclxuICBwdWJsaWMgZGVjb2RlOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBDT05GSUdfREVGQVVMVC5kZWNvZGU7XHJcbiAgcHVibGljIGlzQmVlcDogYm9vbGVhbiB8IHVuZGVmaW5lZCA9IENPTkZJR19ERUZBVUxULmlzQmVlcDtcclxuICBwdWJsaWMgZGV2aWNlQWN0aXZlOiBudW1iZXIgfCB1bmRlZmluZWQgPSBDT05GSUdfREVGQVVMVC5kZXZpY2VBY3RpdmU7XHJcbiAgcHVibGljIGNvbmZpZzogU2Nhbm5lclFSQ29kZUNvbmZpZyA9IENPTkZJR19ERUZBVUxUO1xyXG4gIHB1YmxpYyBjb25zdHJhaW50czogTWVkaWFTdHJlYW1Db25zdHJhaW50cyB8IGFueSB8IHVuZGVmaW5lZCA9IENPTkZJR19ERUZBVUxULmNvbnN0cmFpbnRzO1xyXG5cclxuICAvKipcclxuICAgKiBFeHBvcnRcclxuICAgKi9cclxuICBwdWJsaWMgaXNTdGFydDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHB1YmxpYyBpc0xvYWRpbmc6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBwdWJsaWMgaXNUb3JjaDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHB1YmxpYyBkYXRhID0gbmV3IEJlaGF2aW9yU3ViamVjdDxTY2FubmVyUVJDb2RlUmVzdWx0W10+KFtdKTtcclxuICBwdWJsaWMgZGV2aWNlcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8U2Nhbm5lclFSQ29kZURldmljZVtdPihbXSk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFByaXZhdGVcclxuICAgKi9cclxuICBwcml2YXRlIHJBRl9JRDogYW55O1xyXG4gIHByaXZhdGUgZGF0YUZvclJlc2l6ZTogU2Nhbm5lclFSQ29kZVJlc3VsdFtdID0gW107XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5vdmVycmlkZUNvbmZpZygpO1xyXG4gICAgaWYgKHRoaXMuc3JjKSB7XHJcbiAgICAgIHRoaXMubG9hZEltYWdlKHRoaXMuc3JjKTtcclxuICAgIH1cclxuICAgIHRoaXMucmVzaXplKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBzdGFydFxyXG4gICAqIEByZXR1cm4gQXN5bmNTdWJqZWN0XHJcbiAgICovXHJcbiAgcHVibGljIHN0YXJ0KCk6IEFzeW5jU3ViamVjdDxhbnk+IHtcclxuICAgIGNvbnN0IGFzID0gbmV3IEFzeW5jU3ViamVjdDxhbnk+KCk7XHJcbiAgICBpZiAodGhpcy5pc1N0YXJ0KSB7XHJcbiAgICAgIC8vIFJlamVjdFxyXG4gICAgICBBU19DT01QTEVURShhcywgZmFsc2UpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gbWVkaWFEZXZpY2VzXHJcbiAgICAgIHRoaXMubG9hZEFsbERldmljZXMoYXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogcGxheURldmljZVxyXG4gICAqIEBwYXJhbSBkZXZpY2VJZCBcclxuICAgKiBAcGFyYW0gYXMgXHJcbiAgICogQHJldHVybiBBc3luY1N1YmplY3QgXHJcbiAgICovXHJcbiAgcHVibGljIHBsYXlEZXZpY2UoZGV2aWNlSWQ6IHN0cmluZywgYXM6IEFzeW5jU3ViamVjdDxhbnk+ID0gbmV3IEFzeW5jU3ViamVjdDxhbnk+KCkpOiBBc3luY1N1YmplY3Q8YW55PiB7XHJcbiAgICBjb25zdCBleGlzdERldmljZUlkID0gdGhpcy5pc1N0YXJ0ID8gdGhpcy5nZXRDb25zdHJhaW50cygpLmRldmljZUlkICE9IGRldmljZUlkIDogdHJ1ZTtcclxuICAgIHN3aXRjaCAodHJ1ZSkge1xyXG4gICAgICBjYXNlIGRldmljZUlkID09ICdudWxsJyB8fCBkZXZpY2VJZCA9PSBudWxsOlxyXG4gICAgICAgIHRoaXMuc3RvcCgpO1xyXG4gICAgICAgIEFTX0NPTVBMRVRFKGFzLCBmYWxzZSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgZGV2aWNlSWQgJiYgZXhpc3REZXZpY2VJZDpcclxuICAgICAgICBzdG9wKCk7XHJcbiAgICAgICAgdGhpcy5zdG9wKCk7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnJBRl9JRCk7XHJcbiAgICAgICAgLy8gTG9hZGluZyBvblxyXG4gICAgICAgIHRoaXMuc3RhdHVzKGZhbHNlLCB0cnVlKTtcclxuICAgICAgICBjb25zdCBjb25zdHJhaW50cyA9IHtcclxuICAgICAgICAgIGF1ZGlvOiBmYWxzZSxcclxuICAgICAgICAgIHZpZGVvOiAodHlwZW9mICh0aGlzLmNvbnN0cmFpbnRzICYmIHRoaXMuY29uc3RyYWludHMudmlkZW8pID09PSAnYm9vbGVhbicpID8geyBkZXZpY2VJZDogZGV2aWNlSWQgfSA6IE9iamVjdC5hc3NpZ24oeyBkZXZpY2VJZDogZGV2aWNlSWQgfSwgdGhpcy5jb25zdHJhaW50cyAmJiB0aGlzLmNvbnN0cmFpbnRzLnZpZGVvKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5kZXZpY2VBY3RpdmUgPSB0aGlzLmRldmljZXMudmFsdWUuZmluZEluZGV4KGYgPT4gZi5kZXZpY2VJZCA9PSBkZXZpY2VJZCk7XHJcbiAgICAgICAgLy8gTWVkaWFTdHJlYW1cclxuICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW50cykudGhlbigoc3RyZWFtOiBNZWRpYVN0cmVhbSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy52aWRlby5uYXRpdmVFbGVtZW50LnNyY09iamVjdCA9IHN0cmVhbTtcclxuICAgICAgICAgIHRoaXMudmlkZW8ubmF0aXZlRWxlbWVudC5vbmxvYWRlZG1ldGFkYXRhID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnZpZGVvLm5hdGl2ZUVsZW1lbnQucGxheSgpO1xyXG4gICAgICAgICAgICB0aGlzLnJlcXVlc3RBbmltYXRpb25GcmFtZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1cyh0cnVlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIEFTX0NPTVBMRVRFKGFzLCB0cnVlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLnN0YXR1cyhmYWxzZSwgZmFsc2UpO1xyXG4gICAgICAgICAgdGhpcy5ldmVudEVtaXQoZmFsc2UpO1xyXG4gICAgICAgICAgQVNfQ09NUExFVEUoYXMsIGZhbHNlLCBlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgQVNfQ09NUExFVEUoYXMsIGZhbHNlKTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHJldHVybiBhcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHN0b3BcclxuICAgKiBAcmV0dXJuIEFzeW5jU3ViamVjdFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdG9wKCk6IEFzeW5jU3ViamVjdDxhbnk+IHtcclxuICAgIHRoaXMuZXZlbnRFbWl0KG51bGwpO1xyXG4gICAgdGhpcy5zdGF0dXMoZmFsc2UsIGZhbHNlKTtcclxuICAgIGNvbnN0IGFzID0gbmV3IEFzeW5jU3ViamVjdDxhbnk+KCk7XHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLnJlbW92ZUNhbnZhcygpO1xyXG4gICAgICBjbGVhckludGVydmFsKHRoaXMuckFGX0lEKTtcclxuICAgICAgKHRoaXMudmlkZW8ubmF0aXZlRWxlbWVudC5zcmNPYmplY3QgYXMgTWVkaWFTdHJlYW0pLmdldFRyYWNrcygpLmZvckVhY2goKHRyYWNrOiBhbnkpID0+IHtcclxuICAgICAgICB0cmFjay5zdG9wKCk7XHJcbiAgICAgICAgQVNfQ09NUExFVEUoYXMsIHRydWUpO1xyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIEFTX0NPTVBMRVRFKGFzLCBmYWxzZSwgZXJyb3IgYXMgYW55KTtcclxuICAgIH1cclxuICAgIHJldHVybiBhcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHBsYXlcclxuICAgKiBAcmV0dXJuIEFzeW5jU3ViamVjdFxyXG4gICAqL1xyXG4gIHB1YmxpYyBwbGF5KCk6IEFzeW5jU3ViamVjdDxhbnk+IHtcclxuICAgIGNvbnN0IGFzID0gbmV3IEFzeW5jU3ViamVjdDxhbnk+KCk7XHJcbiAgICBpZiAodGhpcy5pc1BhdXNlKSB7XHJcbiAgICAgIHRoaXMudmlkZW8ubmF0aXZlRWxlbWVudC5wbGF5KCk7XHJcbiAgICAgIHRoaXMucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCk7XHJcbiAgICAgIEFTX0NPTVBMRVRFKGFzLCB0cnVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIEFTX0NPTVBMRVRFKGFzLCBmYWxzZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBwYXVzZVxyXG4gICAqIEByZXR1cm4gQXN5bmNTdWJqZWN0IFxyXG4gICAqL1xyXG4gIHB1YmxpYyBwYXVzZSgpOiBBc3luY1N1YmplY3Q8YW55PiB7XHJcbiAgICBjb25zdCBhcyA9IG5ldyBBc3luY1N1YmplY3Q8YW55PigpO1xyXG4gICAgaWYgKHRoaXMuaXNTdGFydCkge1xyXG4gICAgICBjbGVhckludGVydmFsKHRoaXMuckFGX0lEKTtcclxuICAgICAgdGhpcy52aWRlby5uYXRpdmVFbGVtZW50LnBhdXNlKCk7XHJcbiAgICAgIEFTX0NPTVBMRVRFKGFzLCB0cnVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIEFTX0NPTVBMRVRFKGFzLCBmYWxzZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBsb2FkSW1hZ2VcclxuICAgKiBAcGFyYW0gc3JjIFxyXG4gICAqIEByZXR1cm4gQXN5bmNTdWJqZWN0XHJcbiAgICovXHJcbiAgcHVibGljIGxvYWRJbWFnZShzcmM6IHN0cmluZyk6IEFzeW5jU3ViamVjdDxhbnk+IHtcclxuICAgIGNvbnN0IGFzID0gbmV3IEFzeW5jU3ViamVjdDxhbnk+KCk7XHJcbiAgICAvLyBMb2FkaW5nIG9uXHJcbiAgICB0aGlzLnN0YXR1cyhmYWxzZSwgdHJ1ZSk7XHJcbiAgICAvLyBTZXQgdGhlIHNyYyBvZiB0aGlzIEltYWdlIG9iamVjdC5cclxuICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICAvLyBTZXR0aW5nIGNyb3NzIG9yaWdpbiB2YWx1ZSB0byBhbm9ueW1vdXNcclxuICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnY3Jvc3NPcmlnaW4nLCAnYW5vbnltb3VzJyk7XHJcbiAgICAvLyBXaGVuIG91ciBpbWFnZSBoYXMgbG9hZGVkLlxyXG4gICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLmRyYXdJbWFnZShpbWFnZSwgKGZsYWc6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICB0aGlzLnN0YXR1cyhmYWxzZSwgZmFsc2UpO1xyXG4gICAgICAgIEFTX0NPTVBMRVRFKGFzLCBmbGFnKTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLy8gU2V0IHNyY1xyXG4gICAgaW1hZ2Uuc3JjID0gc3JjO1xyXG4gICAgcmV0dXJuIGFzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogdG9yY2hlclxyXG4gICAqIEByZXR1cm4gQXN5bmNTdWJqZWN0XHJcbiAgICovXHJcbiAgcHVibGljIHRvcmNoZXIoKTogQXN5bmNTdWJqZWN0PGFueT4ge1xyXG4gICAgY29uc3QgYXMgPSB0aGlzLmFwcGx5Q29uc3RyYWludHMoeyB0b3JjaDogdGhpcy5pc1RvcmNoIH0pXHJcbiAgICBhcy5zdWJzY3JpYmUoKCkgPT4gZmFsc2UsICgpID0+IHRoaXMuaXNUb3JjaCA9ICF0aGlzLmlzVG9yY2gpO1xyXG4gICAgcmV0dXJuIGFzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogYXBwbHlDb25zdHJhaW50c1xyXG4gICAqIEByZXR1cm4gQXN5bmNTdWJqZWN0XHJcbiAgICovXHJcbiAgcHVibGljIGFwcGx5Q29uc3RyYWludHMoY29uc3RyYWludHM6IE1lZGlhVHJhY2tDb25zdHJhaW50U2V0IHwgYW55KTogQXN5bmNTdWJqZWN0PGFueT4ge1xyXG4gICAgY29uc3QgYXMgPSBuZXcgQXN5bmNTdWJqZWN0PGFueT4oKTtcclxuICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMudmlkZW8ubmF0aXZlRWxlbWVudC5zcmNPYmplY3QgYXMgTWVkaWFTdHJlYW07XHJcbiAgICBjb25zdCB2aWRlb1RyYWNrID0gc3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF0gYXMgTWVkaWFTdHJlYW1UcmFjaztcclxuICAgIGNvbnN0IGltYWdlQ2FwdHVyZSA9IG5ldyAod2luZG93IGFzIGFueSkuSW1hZ2VDYXB0dXJlKHZpZGVvVHJhY2spO1xyXG4gICAgaW1hZ2VDYXB0dXJlLmdldFBob3RvQ2FwYWJpbGl0aWVzKCkudGhlbihhc3luYyAoKSA9PiB7XHJcbiAgICAgIGF3YWl0IHZpZGVvVHJhY2suYXBwbHlDb25zdHJhaW50cyh7IGFkdmFuY2VkOiBbY29uc3RyYWludHNdIH0gYXMgTWVkaWFUcmFja0NvbnN0cmFpbnRzKTtcclxuICAgICAgQVNfQ09NUExFVEUoYXMsIHRydWUpO1xyXG4gICAgfSkuY2F0Y2goKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgc3dpdGNoIChlcnJvciAmJiBlcnJvci5uYW1lKSB7XHJcbiAgICAgICAgY2FzZSAnTm90Rm91bmRFcnJvcic6XHJcbiAgICAgICAgY2FzZSAnRGV2aWNlc05vdEZvdW5kRXJyb3InOlxyXG4gICAgICAgICAgQVNfQ09NUExFVEUoYXMsIGZhbHNlLCAnUmVxdWlyZWQgdHJhY2sgaXMgbWlzc2luZycgYXMgYW55KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ05vdFJlYWRhYmxlRXJyb3InOlxyXG4gICAgICAgIGNhc2UgJ1RyYWNrU3RhcnRFcnJvcic6XHJcbiAgICAgICAgICBBU19DT01QTEVURShhcywgZmFsc2UsICdXZWJjYW0gb3IgbWljIGFyZSBhbHJlYWR5IGluIHVzZScgYXMgYW55KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ092ZXJjb25zdHJhaW5lZEVycm9yJzpcclxuICAgICAgICBjYXNlICdDb25zdHJhaW50Tm90U2F0aXNmaWVkRXJyb3InOlxyXG4gICAgICAgICAgQVNfQ09NUExFVEUoYXMsIGZhbHNlLCAnQ29uc3RyYWludHMgY2FuIG5vdCBiZSBzYXRpc2ZpZWQgYnkgYXZiLiBkZXZpY2VzJyBhcyBhbnkpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnTm90QWxsb3dlZEVycm9yJzpcclxuICAgICAgICBjYXNlICdQZXJtaXNzaW9uRGVuaWVkRXJyb3InOlxyXG4gICAgICAgICAgQVNfQ09NUExFVEUoYXMsIGZhbHNlLCAnUGVybWlzc2lvbiBkZW5pZWQgaW4gYnJvd3NlcicgYXMgYW55KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1R5cGVFcnJvcic6XHJcbiAgICAgICAgICBBU19DT01QTEVURShhcywgZmFsc2UsICdFbXB0eSBjb25zdHJhaW50cyBvYmplY3QnIGFzIGFueSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgQVNfQ09NUExFVEUoYXMsIGZhbHNlLCBlcnJvciBhcyBhbnkpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGFzO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIGdldENvbnN0cmFpbnRzXHJcbiAgICogQHBhcmFtIGRldmljZUFjdGl2ZSBcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Q29uc3RyYWludHMoKTogTWVkaWFUcmFja0NvbnN0cmFpbnRTZXQgfCBhbnkge1xyXG4gICAgY29uc3Qgc3RyZWFtID0gdGhpcy52aWRlby5uYXRpdmVFbGVtZW50LnNyY09iamVjdCBhcyBNZWRpYVN0cmVhbTtcclxuICAgIGNvbnN0IHZpZGVvVHJhY2sgPSBzdHJlYW0gJiYgc3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF0gYXMgTWVkaWFTdHJlYW1UcmFjaztcclxuICAgIHJldHVybiB2aWRlb1RyYWNrICYmIHZpZGVvVHJhY2suZ2V0Q29uc3RyYWludHMoKSBhcyBhbnk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBkb3dubG9hZFxyXG4gICAqIEBwYXJhbSBmaWxlTmFtZSBcclxuICAgKiBAcmV0dXJuIEFzeW5jU3ViamVjdFxyXG4gICAqL1xyXG4gIHB1YmxpYyBkb3dubG9hZChmaWxlTmFtZTogc3RyaW5nID0gYG5neC1zY2FubmVyLXFyY29kZS0ke0RhdGUubm93KCl9LnBuZ2ApOiBBc3luY1N1YmplY3Q8U2Nhbm5lclFSQ29kZVNlbGVjdGVkRmlsZXNbXT4ge1xyXG4gICAgY29uc3QgYXMgPSBuZXcgQXN5bmNTdWJqZWN0PGFueT4oKTtcclxuICAgIGNvbnN0IHJ1biA9IGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IENBTlZBU19UT19CTE9CKHRoaXMuY2FudmFzLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICBjb25zdCBmaWxlID0gQkxPQl9UT19GSUxFKGJsb2IsIGZpbGVOYW1lKTtcclxuICAgICAgRklMRVNfVE9fU0NBTihbZmlsZV0sIHRoaXMuY29uZmlnLCBhcykuc3Vic2NyaWJlKChyZXM6IFNjYW5uZXJRUkNvZGVTZWxlY3RlZEZpbGVzW10pID0+IHtcclxuICAgICAgICByZXMuZm9yRWFjaCgoaXRlbTogU2Nhbm5lclFSQ29kZVNlbGVjdGVkRmlsZXMpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgICBsaW5rLmhyZWYgPSBpdGVtLnVybDtcclxuICAgICAgICAgIGxpbmsuZG93bmxvYWQgPSBpdGVtLm5hbWU7XHJcbiAgICAgICAgICBsaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgICBsaW5rLnJlbW92ZSgpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcnVuKCk7XHJcbiAgICByZXR1cm4gYXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiB3aW5kb3c6IHJlc2l6ZVxyXG4gICAqIERyYXcgYWdhaW4hXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZXNpemUoKTogdm9pZCB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmRhdGFGb3JSZXNpemUgJiYgdGhpcy5kYXRhRm9yUmVzaXplLmxlbmd0aCkge1xyXG4gICAgICAgIERSQVdfUkVTVUxUX0FQUEVORF9DSElMRCh0aGlzLmRhdGFGb3JSZXNpemUgYXMgYW55LCB0aGlzLmNhbnZhcy5uYXRpdmVFbGVtZW50LCB0aGlzLnJlc3VsdHNQYW5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBPdmVycmlkZSBjb25maWdcclxuICAgKiBAcmV0dXJuIHZvaWRcclxuICAgKi9cclxuICBwcml2YXRlIG92ZXJyaWRlQ29uZmlnKCk6IHZvaWQge1xyXG4gICAgaWYgKEhBU19PV05fUFJPUEVSVFkodGhpcy5jb25maWcsICdzcmMnKSkgdGhpcy5zcmMgPSB0aGlzLmNvbmZpZy5zcmM7XHJcbiAgICBpZiAoSEFTX09XTl9QUk9QRVJUWSh0aGlzLmNvbmZpZywgJ2ZwcycpKSB0aGlzLmZwcyA9IHRoaXMuY29uZmlnLmZwcztcclxuICAgIGlmIChIQVNfT1dOX1BST1BFUlRZKHRoaXMuY29uZmlnLCAndmlicmF0ZScpKSB0aGlzLnZpYnJhdGUgPSB0aGlzLmNvbmZpZy52aWJyYXRlO1xyXG4gICAgaWYgKEhBU19PV05fUFJPUEVSVFkodGhpcy5jb25maWcsICdkZWNvZGUnKSkgdGhpcy5kZWNvZGUgPSB0aGlzLmNvbmZpZy5kZWNvZGU7XHJcbiAgICBpZiAoSEFTX09XTl9QUk9QRVJUWSh0aGlzLmNvbmZpZywgJ2lzQmVlcCcpKSB0aGlzLmlzQmVlcCA9IHRoaXMuY29uZmlnLmlzQmVlcDtcclxuICAgIGlmIChIQVNfT1dOX1BST1BFUlRZKHRoaXMuY29uZmlnLCAnZGV2aWNlQWN0aXZlJykpIHRoaXMuZGV2aWNlQWN0aXZlID0gdGhpcy5jb25maWcuZGV2aWNlQWN0aXZlO1xyXG4gICAgaWYgKEhBU19PV05fUFJPUEVSVFkodGhpcy5jb25maWcsICdjb25zdHJhaW50cycpKSB0aGlzLmNvbnN0cmFpbnRzID0gT1ZFUlJJREVTKCdjb25zdHJhaW50cycsIHRoaXMuY29uZmlnLCBNRURJQV9TVFJFQU1fREVGQVVMVCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBsb2FkQWxsRGV2aWNlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgbG9hZEFsbERldmljZXMoYXM6IEFzeW5jU3ViamVjdDxhbnk+KTogdm9pZCB7XHJcbiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoKS50aGVuKGRldmljZXMgPT4ge1xyXG4gICAgICBsZXQgY2FtZXJhRGV2aWNlczogU2Nhbm5lclFSQ29kZURldmljZVtdID0gW107XHJcbiAgICAgIGRldmljZXMuZm9yRWFjaChmID0+IGYua2luZCA9PSAndmlkZW9pbnB1dCcgJiYgY2FtZXJhRGV2aWNlcy5wdXNoKGYpKTtcclxuICAgICAgdGhpcy5kZXZpY2VzLm5leHQoY2FtZXJhRGV2aWNlcyk7XHJcbiAgICAgIGlmIChjYW1lcmFEZXZpY2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IE1hdGgubWF4KDAsIChjYW1lcmFEZXZpY2VzLmxlbmd0aCA+IHRoaXMuZGV2aWNlQWN0aXZlID8gdGhpcy5kZXZpY2VBY3RpdmUgOiAwKSk7XHJcbiAgICAgICAgdGhpcy5wbGF5RGV2aWNlKGNhbWVyYURldmljZXNbaW5kZXhdLmRldmljZUlkLCBhcyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgQVNfQ09NUExFVEUoYXMsIGZhbHNlLCAnTm8gY2FtZXJhIGRldGVjdGVkLicgYXMgYW55KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBkcmF3SW1hZ2VcclxuICAgKiBAcGFyYW0gZWxlbWVudCBcclxuICAgKiBAcGFyYW0gY2FsbGJhY2sgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBkcmF3SW1hZ2UoZWxlbWVudDogSFRNTEltYWdlRWxlbWVudCB8IEhUTUxWaWRlb0VsZW1lbnQsIGNhbGxiYWNrOiBGdW5jdGlvbiA9ICgpID0+IHsgfSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgLy8gR2V0IHRoZSBjYW52YXMgZWxlbWVudCBieSB1c2luZyB0aGUgZ2V0RWxlbWVudEJ5SWQgbWV0aG9kLlxyXG4gICAgY29uc3QgY2FudmFzID0gdGhpcy5jYW52YXMubmF0aXZlRWxlbWVudDtcclxuICAgIC8vIEdldCBhIDJEIGRyYXdpbmcgY29udGV4dCBmb3IgdGhlIGNhbnZhcy5cclxuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcsIHsgd2lsbFJlYWRGcmVxdWVudGx5OiB0cnVlIH0pIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuICAgIC8vIEhUTUxJbWFnZUVsZW1lbnQgc2l6ZVxyXG4gICAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50KSB7XHJcbiAgICAgIGNhbnZhcy53aWR0aCA9IGVsZW1lbnQubmF0dXJhbFdpZHRoO1xyXG4gICAgICBjYW52YXMuaGVpZ2h0ID0gZWxlbWVudC5uYXR1cmFsSGVpZ2h0O1xyXG4gICAgICBlbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAnJztcclxuICAgICAgdGhpcy52aWRlby5uYXRpdmVFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgICAgdGhpcy52aWRlby5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9IGNhbnZhcy5vZmZzZXRIZWlnaHQgKyAncHgnO1xyXG4gICAgfVxyXG4gICAgLy8gSFRNTFZpZGVvRWxlbWVudCBzaXplXHJcbiAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEhUTUxWaWRlb0VsZW1lbnQpIHtcclxuICAgICAgY2FudmFzLndpZHRoID0gZWxlbWVudC52aWRlb1dpZHRoO1xyXG4gICAgICBjYW52YXMuaGVpZ2h0ID0gZWxlbWVudC52aWRlb0hlaWdodDtcclxuICAgICAgZWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJyc7XHJcbiAgICAgIHRoaXMuY2FudmFzLm5hdGl2ZUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xyXG4gICAgfVxyXG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpXHJcbiAgICAvLyBEcmF3IGltYWdlXHJcbiAgICBjdHguZHJhd0ltYWdlKGVsZW1lbnQsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcbiAgICAvLyBEYXRhIGltYWdlXHJcbiAgICBjb25zdCBpbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcbiAgICAvLyBEcmF3IGZyYW1lXHJcbiAgICBjb25zdCBjb2RlID0gYXdhaXQgemJhcldhc20uc2NhbkltYWdlRGF0YShpbWFnZURhdGEpO1xyXG4gICAgaWYgKGNvZGUgJiYgY29kZS5sZW5ndGgpIHtcclxuICAgICAgLy8gRGVjb2RlXHJcbiAgICAgIGNvZGUuZm9yRWFjaCgoczogYW55KSA9PiBzLnZhbHVlID0gcy5kZWNvZGUodGhpcy5kZWNvZGUgJiYgdGhpcy5kZWNvZGUudG9Mb2NhbGVMb3dlckNhc2UoKSkpO1xyXG5cclxuICAgICAgLy8gT3ZlcmxheVxyXG4gICAgICBEUkFXX1JFU1VMVF9BUFBFTkRfQ0hJTEQoY29kZSwgT2JqZWN0LmZyZWV6ZSh0aGlzLmNhbnZhcy5uYXRpdmVFbGVtZW50KSwgdGhpcy5yZXN1bHRzUGFuZWwubmF0aXZlRWxlbWVudCk7XHJcblxyXG4gICAgICAvLyBUbyBibG9iIGFuZCBlbWl0IGRhdGFcclxuICAgICAgY29uc3QgRU1JVF9EQVRBID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZXZlbnRFbWl0KGNvZGUpO1xyXG4gICAgICAgIHRoaXMuZGF0YUZvclJlc2l6ZSA9IGNvZGU7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBIVE1MSW1hZ2VFbGVtZW50XHJcbiAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCkge1xyXG4gICAgICAgIGNhbGxiYWNrKHRydWUpO1xyXG4gICAgICAgIEVNSVRfREFUQSgpO1xyXG4gICAgICAgIFZJQlJBVEUodGhpcy52aWJyYXRlKTtcclxuICAgICAgICBQTEFZX0FVRElPKHRoaXMuaXNCZWVwKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBIVE1MVmlkZW9FbGVtZW50XHJcbiAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgSFRNTFZpZGVvRWxlbWVudCkge1xyXG4gICAgICAgIEVNSVRfREFUQSgpO1xyXG4gICAgICAgIFZJQlJBVEUodGhpcy52aWJyYXRlKTtcclxuICAgICAgICBQTEFZX0FVRElPKHRoaXMuaXNCZWVwKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY2FsbGJhY2soZmFsc2UpO1xyXG4gICAgICB0aGlzLnJlbW92ZUNhbnZhcygpO1xyXG4gICAgICB0aGlzLmRhdGFGb3JSZXNpemUgPSBjb2RlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogcmVtb3ZlQ2FudmFzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZW1vdmVDYW52YXMoKTogdm9pZCB7XHJcbiAgICBPYmplY3QuYXNzaWduKFtdLCB0aGlzLnJlc3VsdHNQYW5lbC5uYXRpdmVFbGVtZW50LmNoaWxkTm9kZXMpLmZvckVhY2goZWwgPT4gdGhpcy5yZXN1bHRzUGFuZWwubmF0aXZlRWxlbWVudC5yZW1vdmVDaGlsZChlbCkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogc3RhdHVzXHJcbiAgICogQHBhcmFtIGlzU3RhcnQgXHJcbiAgICogQHBhcmFtIGlzTG9hZGluZyBcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXR1cyhpc1N0YXJ0OiBib29sZWFuLCBpc0xvYWRpbmc6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIHRoaXMuaXNTdGFydCA9IGlzU3RhcnQ7XHJcbiAgICB0aGlzLmlzTG9hZGluZyA9IGlzTG9hZGluZztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGV2ZW50RW1pdFxyXG4gICAqIEBwYXJhbSByZXNwb25zZSBcclxuICAgKi9cclxuICBwcml2YXRlIGV2ZW50RW1pdChyZXNwb25zZTogYW55ID0gZmFsc2UpOiB2b2lkIHtcclxuICAgIChyZXNwb25zZSAhPT0gZmFsc2UpICYmIHRoaXMuZGF0YS5uZXh0KHJlc3BvbnNlIHx8IHsgZGF0YTogbnVsbCB9KTtcclxuICAgIChyZXNwb25zZSAhPT0gZmFsc2UpICYmIHRoaXMuZXZlbnQuZW1pdChyZXNwb25zZSB8fCB7IGRhdGE6IG51bGwgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTaW5nbGUtdGhyZWFkXHJcbiAgICogTG9vcCBSZWNvcmRpbmcgb24gQ2FtZXJhXHJcbiAgICogTXVzdCBiZSBkZXN0cm95IHJlcXVlc3QgXHJcbiAgICogTm90IHVzaW5nOiByZXF1ZXN0QW5pbWF0aW9uRnJhbWVcclxuICAgKi9cclxuICBwcml2YXRlIHJlcXVlc3RBbmltYXRpb25GcmFtZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuckFGX0lEID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy52aWRlby5uYXRpdmVFbGVtZW50LnJlYWR5U3RhdGUgPT09IHRoaXMudmlkZW8ubmF0aXZlRWxlbWVudC5IQVZFX0VOT1VHSF9EQVRBKSB7XHJcbiAgICAgICAgdGhpcy5kcmF3SW1hZ2UodGhpcy52aWRlby5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgfSwgdGhpcy5mcHMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhdHVzIG9mIGNhbWVyYVxyXG4gICAqIEByZXR1cm4gYm9vbGVhblxyXG4gICAqL1xyXG4gIGdldCBpc1BhdXNlKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaXNTdGFydCAmJiB0aGlzLnZpZGVvLm5hdGl2ZUVsZW1lbnQucGF1c2VkO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLnBhdXNlKCk7XHJcbiAgfVxyXG59Il19